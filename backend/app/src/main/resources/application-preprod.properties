# PreProd Environment Configuration with MySQL on GCP
# ============================================
# GCP SECRET MANAGER INTEGRATION
# ============================================
# Secrets are read from GCP Secret Manager using sm:// prefix
# Format: ${sm://projects/PROJECT_ID/secrets/SECRET_NAME/versions/latest}
# Short format: ${sm://SECRET_NAME} (uses default project from bootstrap.yml)
# Falls back to environment variables if Secret Manager is not available

spring.datasource.url=jdbc:mysql://google/perundhu?socketFactory=com.google.cloud.sql.mysql.SocketFactory&cloudSqlInstance=${GCP_INSTANCE_CONNECTION_NAME}
spring.datasource.username=${DB_USERNAME:${MYSQL_USERNAME:perundhu_user}}
spring.datasource.password=${DB_PASSWORD:${MYSQL_PASSWORD:}}
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# Multipart file upload configuration
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=15MB
spring.servlet.multipart.enabled=true

# Flyway configuration for pre-production
spring.flyway.enabled=true
spring.flyway.locations=classpath:db/migration/mysql
spring.flyway.baseline-on-migrate=true
spring.flyway.clean-disabled=true
spring.flyway.validate-on-migrate=true

# Hibernate configuration for MySQL
spring.jpa.database-platform=org.hibernate.dialect.MySQL8Dialect
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=${SHOW_SQL:false}

# Connection pool configuration
spring.datasource.hikari.maximum-pool-size=${HIKARI_MAX_POOL_SIZE:5}
spring.datasource.hikari.minimum-idle=${HIKARI_MIN_IDLE:2}

# Server configuration
server.port=${SERVER_PORT:8080}

# File storage configuration for PreProd
app.file.base-url=${APP_FILE_BASE_URL:https://perundhu-backend-preprod-c6qn3mz4wa-el.a.run.app}

# CORS Configuration for PreProd (allow frontend Cloud Run URL)
cors.allowed-origins=${CORS_ALLOWED_ORIGINS:https://perundhu-frontend-preprod-1032721240281.asia-south1.run.app}

# Logging
logging.level.root=${LOG_LEVEL_ROOT:INFO}
logging.level.com.perundhu=${LOG_LEVEL_APP:INFO}
logging.level.org.flywaydb=INFO

# ============================================
# PREPROD SECURITY CONFIGURATION
# ============================================
# Rate Limiting - Enabled with moderate limits
rate-limit.enabled=true
rate-limit.read.requests-per-minute=100
rate-limit.write.requests-per-minute=20
rate-limit.upload.requests-per-minute=10

# Origin Validation - Enabled, non-strict mode for testing
security.origin-validation.enabled=true
security.origin-validation.strict-mode=false
security.allowed-origins=${CORS_ALLOWED_ORIGINS:https://perundhu-frontend-preprod-1032721240281.asia-south1.run.app}

# Honeypot - Enabled
security.honeypot.enabled=true

# reCAPTCHA - Enabled if configured (Shared secrets from GCP Secret Manager)
recaptcha.enabled=${RECAPTCHA_ENABLED:true}
recaptcha.site-key=${sm://recaptcha-site-key}
recaptcha.secret-key=${sm://recaptcha-secret-key}
recaptcha.score-threshold=0.5

# API Key - Disabled for preprod (enable when ready)
security.api-key.enabled=false