# Production Environment Configuration
spring.datasource.url=${DB_URL}
spring.datasource.username=${DB_USERNAME}
spring.datasource.password=${DB_PASSWORD}
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# Multipart file upload configuration
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=15MB
spring.servlet.multipart.enabled=true

# Flyway configuration for production
spring.flyway.enabled=true
spring.flyway.locations=classpath:db/migration/mysql
spring.flyway.baseline-on-migrate=true
spring.flyway.clean-disabled=true
spring.flyway.validate-on-migrate=true

# Hibernate configuration
spring.jpa.database-platform=org.hibernate.dialect.MySQL8Dialect
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect

# Disable schema validation to prevent circular dependency with Flyway
spring.jpa.properties.hibernate.validator.apply_to_ddl=false
spring.jpa.properties.hibernate.temp.use_jdbc_metadata_defaults=false

# Let Flyway handle all schema management
spring.sql.init.mode=never
spring.jpa.defer-datasource-initialization=false

# Connection pool configuration
spring.datasource.hikari.maximum-pool-size=${HIKARI_MAX_POOL_SIZE:10}
spring.datasource.hikari.minimum-idle=${HIKARI_MIN_IDLE:5}
spring.datasource.hikari.connection-timeout=${HIKARI_TIMEOUT:30000}
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.auto-commit=true
spring.datasource.hikari.pool-name=PerundhuProductionHikariCP

# Server configuration
server.port=${SERVER_PORT:8080}

# Logging - Production settings
logging.level.root=${LOG_LEVEL_ROOT:WARN}
logging.level.com.perundhu=${LOG_LEVEL_APP:INFO}
logging.level.org.springframework=WARN
logging.level.org.hibernate=WARN
logging.level.com.zaxxer.hikari=INFO
logging.level.org.flywaydb=INFO

# Log file configuration
logging.file.name=logs/perundhu-production.log
logging.file.max-size=10MB
logging.file.max-history=30

# CORS Configuration
cors.allowed-origins=${CORS_ALLOWED_ORIGINS:https://perundhu.app,https://www.perundhu.app}
cors.allowed-methods=${CORS_ALLOWED_METHODS:GET,POST,PUT,DELETE,OPTIONS}
cors.allowed-headers=${CORS_ALLOWED_HEADERS:*}
cors.allow-credentials=${CORS_ALLOW_CREDENTIALS:true}
cors.max-age=${CORS_MAX_AGE:3600}

# Security settings
security.require-ssl=${REQUIRE_SSL:true}
security.jwt.secret=${JWT_SECRET}

# OAuth2 Resource Server Configuration
spring.security.oauth2.resourceserver.jwt.jwk-set-uri=${JWT_JWK_SET_URI:}
spring.security.oauth2.resourceserver.jwt.issuer-uri=${JWT_ISSUER_URI:}
spring.security.oauth2.resourceserver.jwt.audiences=${JWT_AUDIENCES:perundhu-api}

# Session management (stateless for JWT)
server.servlet.session.persistent=false

# Enhanced Security Configuration
security.api.rate-limit.enabled=true
security.ip-filtering.enabled=true
security.data.encryption.enabled=true
security.data.encryption.key=${DATA_ENCRYPTION_KEY}

# Rate limiting configuration
security.rate-limit.public-endpoints=30
security.rate-limit.authenticated-users=300
security.rate-limit.premium-users=1000
security.rate-limit.admin-users=5000

# IP filtering configuration  
security.ip-filtering.block-suspicious-agents=true
security.ip-filtering.block-private-networks=false
security.ip-filtering.max-requests-per-second=10
security.ip-filtering.max-unique-endpoints=20

# Data protection settings
security.data.obfuscate-for-non-premium=true
security.data.encrypt-sensitive-endpoints=true
security.data.log-access-attempts=true

# Security monitoring
security.monitoring.enabled=true
security.monitoring.alert-threshold=100
security.monitoring.block-after-violations=5

# Audit logging
security.audit.enabled=true
security.audit.log-file=logs/security-audit.log
security.audit.retention-days=90

# Anti-scraping measures
security.anti-scraping.enabled=true
security.anti-scraping.max-pages-per-session=50
security.anti-scraping.block-automated-tools=true

# Session security
security.session.timeout-minutes=30
security.session.max-concurrent-sessions=3
security.session.invalidate-on-suspicious-activity=true

# Feature flags
feature.rewards.enabled=true

# Automatic Approval Configuration
perundhu.automatic-approval.enabled=true
perundhu.automatic-approval.daily-limit=100
perundhu.automatic-approval.trusted-contributors=${TRUSTED_CONTRIBUTORS:admin}
perundhu.automatic-approval.min-confidence-score=0.9

# Disable Google Cloud SQL auto-configuration
spring.cloud.gcp.sql.enabled=false
spring.autoconfigure.exclude=com.google.cloud.spring.autoconfigure.sql.GcpCloudSqlAutoConfiguration

# Allow bean definition overriding
spring.main.allow-bean-definition-overriding=true
