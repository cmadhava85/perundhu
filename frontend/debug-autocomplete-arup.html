<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autocomplete Debug - "Arup" Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 4px;
        }
        .success { background: #d4edda; }
        .error { background: #f8d7da; }
        input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .suggestions {
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-top: 10px;
            max-height: 200px;
            overflow-y: auto;
        }
        .suggestion-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }
        .suggestion-item:hover {
            background: #f0f0f0;
        }
    </style>
</head>
<body>
    <h1>üîç Autocomplete Debug Test - "Arup" ‚Üí "Aruppukottai"</h1>
    
    <div class="test-section">
        <h2>1. Instant Local Suggestions Test</h2>
        <p>Testing if "Arup" finds "Aruppukottai" in local COMMON_CITIES array</p>
        <input type="text" id="localTest" placeholder="Type 'Arup' here..." />
        <div id="localResults" class="suggestions"></div>
        <div id="localStatus" class="result"></div>
    </div>

    <div class="test-section">
        <h2>2. OpenStreetMap API Test</h2>
        <p>Testing Nominatim API response for "Arup"</p>
        <button onclick="testNominatimAPI()">Test Nominatim API for "Arup"</button>
        <div id="nominatimResults" class="result"></div>
    </div>

    <div class="test-section">
        <h2>3. Full Autocomplete Service Test</h2>
        <p>Testing the complete locationAutocompleteService.getLocationSuggestions()</p>
        <input type="text" id="fullTest" placeholder="Type 'Arup' here..." />
        <div id="fullResults" class="suggestions"></div>
        <div id="fullStatus" class="result"></div>
    </div>

    <script>
        // Common TN cities for local testing
        const COMMON_CITIES = [
            'Chennai', 'Madurai', 'Coimbatore', 'Tiruchirappalli', 'Salem', 'Tirunelveli', 'Tiruppur',
            'Dindigul', 'Thanjavur', 'Ranipet', 'Sivakasi', 'Karur', 'Udhagamandalam', 'Hosur',
            'Nagercoil', 'Kanchipuram', 'Erode', 'Tiruvannamalai', 'Pollachi', 'Rajapalayam',
            'Arcot', 'Dharmapuri', 'Chidambaram', 'Ambur', 'Nagapattinam', 'Arakkonam', 'Kumbakonam', 'Neyveli', 
            'Cuddalore', 'Mayiladuthurai', 'Pallavaram', 'Pudukkottai', 'Aruppukottai',
            'Virudhunagar', 'Kodaikanal', 'Yercaud', 'Kanyakumari', 'Srivilliputhur', 'Ramanathapuram',
            'Tenkasi', 'Theni', 'Palani', 'Krishnagiri', 'Namakkal', 'Villupuram', 'Vellore',
            'Tiruvallur', 'Tirupattur', 'Kallakurichi', 'Chengalpattu', 'Thoothukudi', 'Tiruvarur',
            'Perambalur', 'Ariyalur', 'Nilgiris', 'Thenkasi'
        ];

        // 1. Test local instant suggestions
        function testLocalSuggestions(query) {
            const lowerQuery = query.toLowerCase();
            const matches = [];
            
            COMMON_CITIES.forEach((city, index) => {
                if (city.toLowerCase().includes(lowerQuery)) {
                    matches.push({
                        id: -(1000 + index),
                        name: city,
                        source: 'local'
                    });
                }
            });
            
            return matches;
        }

        document.getElementById('localTest').addEventListener('input', function(e) {
            const query = e.target.value;
            const results = testLocalSuggestions(query);
            
            const resultsDiv = document.getElementById('localResults');
            const statusDiv = document.getElementById('localStatus');
            
            resultsDiv.innerHTML = '';
            
            if (results.length > 0) {
                results.forEach(result => {
                    const item = document.createElement('div');
                    item.className = 'suggestion-item';
                    item.textContent = `${result.name} (${result.source})`;
                    resultsDiv.appendChild(item);
                });
                
                const aruppukottaiFound = results.some(r => r.name === 'Aruppukottai');
                statusDiv.className = aruppukottaiFound ? 'result success' : 'result';
                statusDiv.textContent = aruppukottaiFound ? 
                    '‚úÖ Aruppukottai found in local suggestions!' : 
                    `‚ö†Ô∏è Found ${results.length} results, but Aruppukottai not included`;
            } else {
                statusDiv.className = 'result error';
                statusDiv.textContent = '‚ùå No local suggestions found';
            }
        });

        // 2. Test Nominatim API directly
        async function testNominatimAPI() {
            const resultsDiv = document.getElementById('nominatimResults');
            resultsDiv.textContent = 'Testing Nominatim API...';
            
            try {
                const query = 'Arup';
                const searchQuery = `${query}, Tamil Nadu, India`;
                
                const params = new URLSearchParams({
                    q: searchQuery,
                    format: 'json',
                    countrycodes: 'in',
                    limit: '10',
                    addressdetails: '1',
                    bounded: '1',
                    viewbox: '76.0,8.0,80.5,13.5' // Tamil Nadu bounding box
                });

                const response = await fetch(`https://nominatim.openstreetmap.org/search?${params}`, {
                    headers: {
                        'User-Agent': 'Perundhu Debug Test'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const data = await response.json();
                
                resultsDiv.className = 'result';
                resultsDiv.innerHTML = `
                    <h4>Nominatim API Results for "${query}":</h4>
                    <p><strong>Query sent:</strong> ${searchQuery}</p>
                    <p><strong>Results count:</strong> ${data.length}</p>
                    <div style="max-height: 200px; overflow-y: auto;">
                        ${data.map(item => `
                            <div style="border: 1px solid #ccc; margin: 5px 0; padding: 10px;">
                                <strong>${item.display_name}</strong><br>
                                Type: ${item.type}, Class: ${item.class}<br>
                                Importance: ${item.importance || 'N/A'}
                            </div>
                        `).join('')}
                    </div>
                `;
                
                const hasAruppukottai = data.some(item => 
                    item.display_name.toLowerCase().includes('aruppukottai')
                );
                
                if (hasAruppukottai) {
                    resultsDiv.className += ' success';
                    resultsDiv.innerHTML += '<p>‚úÖ Aruppukottai found in Nominatim results!</p>';
                } else {
                    resultsDiv.innerHTML += '<p>‚ö†Ô∏è Aruppukottai not found in Nominatim results for "Arup"</p>';
                }
                
            } catch (error) {
                resultsDiv.className = 'result error';
                resultsDiv.textContent = `‚ùå Nominatim API Error: ${error.message}`;
            }
        }

        // 3. Test suggestions with different queries
        document.getElementById('fullTest').addEventListener('input', function(e) {
            const query = e.target.value;
            
            if (query.length < 2) {
                document.getElementById('fullResults').innerHTML = '';
                document.getElementById('fullStatus').textContent = '';
                return;
            }
            
            const resultsDiv = document.getElementById('fullResults');
            const statusDiv = document.getElementById('fullStatus');
            
            // Simulate the smart search logic
            const instantResults = testLocalSuggestions(query);
            
            resultsDiv.innerHTML = '';
            instantResults.forEach(result => {
                const item = document.createElement('div');
                item.className = 'suggestion-item';
                item.textContent = `${result.name} (instant)`;
                resultsDiv.appendChild(item);
            });
            
            statusDiv.textContent = `Instant results: ${instantResults.length}`;
            
            if (instantResults.some(r => r.name === 'Aruppukottai')) {
                statusDiv.className = 'result success';
                statusDiv.textContent += ' ‚úÖ Aruppukottai found!';
            }
        });

        // Auto-test "Arup" on page load
        window.addEventListener('load', function() {
            document.getElementById('localTest').value = 'Arup';
            document.getElementById('localTest').dispatchEvent(new Event('input'));
            
            document.getElementById('fullTest').value = 'Arup';
            document.getElementById('fullTest').dispatchEvent(new Event('input'));
        });
    </script>
</body>
</html>