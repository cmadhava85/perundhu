<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç Page Reload Debug Tool</title>
    <style>
        body {
            font-family: 'Monaco', 'Consolas', monospace;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #1a1a1a;
            color: #00ff00;
        }
        
        .debug-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #333;
            border-radius: 8px;
            background-color: #2a2a2a;
        }
        
        .log-container {
            background: #000;
            border: 1px solid #333;
            border-radius: 4px;
            padding: 10px;
            max-height: 300px;
            overflow-y: auto;
            font-size: 12px;
            margin: 10px 0;
        }
        
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .status.ok { background-color: #004400; }
        .status.warning { background-color: #444400; color: #ffff00; }
        .status.error { background-color: #440000; color: #ff0000; }
        
        .counter {
            font-size: 24px;
            text-align: center;
            margin: 20px 0;
            color: #ff6600;
        }
    </style>
</head>
<body>
    <h1>üîç Page Reload Debug Tool</h1>
    <p>This tool monitors for continuous page reloads and helps identify the cause</p>

    <div class="debug-section">
        <h3>üìä Reload Detection</h3>
        <div class="counter" id="reloadCounter">Page Loads: 1</div>
        <div class="status ok" id="reloadStatus">Monitoring for continuous reloads...</div>
    </div>

    <div class="debug-section">
        <h3>üîÑ Auto-Refresh Detection</h3>
        <div id="refreshStatus" class="status ok">No auto-refresh detected</div>
        <div>Last check: <span id="lastCheck">Starting...</span></div>
    </div>

    <div class="debug-section">
        <h3>üìù Console Errors & Warnings</h3>
        <div class="log-container" id="consoleLog">Monitoring console output...</div>
    </div>

    <div class="debug-section">
        <h3>üåê Network Activity</h3>
        <div id="networkStatus" class="status ok">Monitoring network requests...</div>
        <div class="log-container" id="networkLog">Waiting for network activity...</div>
    </div>

    <div class="debug-section">
        <h3>üß† Memory Usage</h3>
        <div id="memoryStatus" class="status ok">Memory usage: Normal</div>
        <div id="memoryDetails">Heap: -- MB, Used: -- MB</div>
    </div>

    <script>
        let reloadCount = parseInt(localStorage.getItem('reloadCount') || '1');
        let startTime = Date.now();
        let networkRequests = 0;
        let consecutiveErrors = 0;
        
        // Update reload counter
        document.getElementById('reloadCounter').textContent = `Page Loads: ${reloadCount}`;
        localStorage.setItem('reloadCount', (reloadCount + 1).toString());
        
        // Check for rapid reloads
        const lastLoadTime = parseInt(localStorage.getItem('lastLoadTime') || '0');
        const timeSinceLastLoad = Date.now() - lastLoadTime;
        localStorage.setItem('lastLoadTime', Date.now().toString());
        
        if (timeSinceLastLoad < 2000 && reloadCount > 3) {
            document.getElementById('reloadStatus').className = 'status error';
            document.getElementById('reloadStatus').textContent = 
                `‚ö†Ô∏è RAPID RELOADS DETECTED! ${reloadCount} loads in rapid succession`;
        }
        
        function log(container, message, type = 'info') {
            const logElement = document.getElementById(container);
            const timestamp = new Date().toLocaleTimeString();
            const entry = `[${timestamp}] ${message}\\n`;
            logElement.textContent += entry;
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        // Monitor console errors
        const originalError = console.error;
        const originalWarn = console.warn;
        const originalLog = console.log;
        
        console.error = function(...args) {
            log('consoleLog', `ERROR: ${args.join(' ')}`, 'error');
            consecutiveErrors++;
            if (consecutiveErrors > 5) {
                document.getElementById('refreshStatus').className = 'status error';
                document.getElementById('refreshStatus').textContent = 
                    'üö® Excessive console errors detected - likely causing reload loop!';
            }
            originalError.apply(console, args);
        };
        
        console.warn = function(...args) {
            log('consoleLog', `WARN: ${args.join(' ')}`, 'warn');
            originalWarn.apply(console, args);
        };
        
        console.log = function(...args) {
            const message = args.join(' ');
            // Only log React/Component related messages
            if (message.includes('React') || message.includes('useEffect') || 
                message.includes('render') || message.includes('setState')) {
                log('consoleLog', `LOG: ${message}`, 'info');
            }
            originalLog.apply(console, args);
        };
        
        // Monitor network requests
        const originalFetch = window.fetch;
        window.fetch = function(...args) {
            networkRequests++;
            const url = args[0];
            log('networkLog', `FETCH: ${url}`);
            
            if (networkRequests > 20) {
                document.getElementById('networkStatus').className = 'status warning';
                document.getElementById('networkStatus').textContent = 
                    `‚ö†Ô∏è High network activity: ${networkRequests} requests`;
            }
            
            return originalFetch.apply(this, args);
        };
        
        // Monitor for auto-refresh patterns - Enhanced detection
        let refreshCheckCount = 0;
        let lastRefreshTime = Date.now();
        setInterval(() => {
            refreshCheckCount++;
            document.getElementById('lastCheck').textContent = new Date().toLocaleTimeString();
            
            // Check if page was refreshed recently
            const now = Date.now();
            if (now - lastRefreshTime < 5000 && refreshCheckCount > 2) {
                document.getElementById('refreshStatus').className = 'status warning';
                document.getElementById('refreshStatus').textContent = 
                    'üîÑ Rapid refresh pattern detected - check for infinite loops!';
            }
            lastRefreshTime = now;
            
            // Check for performance issues
            if (performance.navigation && performance.navigation.type === 1) {
                document.getElementById('refreshStatus').className = 'status warning';
                document.getElementById('refreshStatus').textContent = 
                    'üîÑ Page was refreshed (not navigated to)';
            }
            
            // Monitor HMR websocket connections
            try {
                const connections = document.querySelectorAll('script[src*="vite"]').length;
                if (connections > 1) {
                    log('consoleLog', `Multiple Vite connections detected: ${connections}`, 'warn');
                }
            } catch (e) {
                // Ignore errors in connection detection
            }
            
            // Monitor memory usage if available
            if (performance.memory) {
                const heap = Math.round(performance.memory.totalJSHeapSize / 1024 / 1024);
                const used = Math.round(performance.memory.usedJSHeapSize / 1024 / 1024);
                
                document.getElementById('memoryDetails').textContent = 
                    `Heap: ${heap} MB, Used: ${used} MB`;
                
                if (used > 100) {
                    document.getElementById('memoryStatus').className = 'status warning';
                    document.getElementById('memoryStatus').textContent = 
                        '‚ö†Ô∏è High memory usage detected';
                }
            }
            
        }, 2000); // Increased interval to reduce monitoring overhead
        
        // Check for infinite loops by monitoring execution time
        let executionCount = 0;
        const checkExecution = () => {
            executionCount++;
            if (executionCount > 100) {
                log('consoleLog', 'POSSIBLE INFINITE LOOP: Too many rapid executions!', 'error');
                document.getElementById('refreshStatus').className = 'status error';
                document.getElementById('refreshStatus').textContent = 
                    'üîÑ INFINITE LOOP DETECTED!';
            }
        };
        
        // Hook into common React patterns that might cause loops
        if (window.React) {
            log('consoleLog', 'React detected - monitoring for render loops', 'info');
        }
        
        // Auto-clear reload count after 30 seconds of no reloads
        setTimeout(() => {
            if (reloadCount < 10) {
                localStorage.removeItem('reloadCount');
                localStorage.removeItem('lastLoadTime');
                document.getElementById('reloadStatus').className = 'status ok';
                document.getElementById('reloadStatus').textContent = 'No reload issues detected';
            }
        }, 30000);
        
        log('consoleLog', 'Debug tool initialized - monitoring for reload patterns...', 'info');
        log('networkLog', 'Network monitoring started');
    </script>
</body>
</html>