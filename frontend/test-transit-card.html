<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TransitBusCard Map Test</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f7;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #1d1d1f;
            margin-bottom: 20px;
        }
        
        .map-container {
            height: 400px;
            width: 100%;
            border-radius: 8px;
            border: 1px solid #e1e5e9;
            margin-bottom: 20px;
        }
        
        .stops-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .stops-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .stop-item {
            background: white;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #e1e5e9;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .stop-number {
            background: #007AFF;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }
        
        .stop-name {
            font-weight: 500;
            color: #1d1d1f;
        }
        
        /* Custom marker styles */
        .custom-stop-marker {
            background: none !important;
            border: none !important;
        }
        
        .stop-marker {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 700;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            border: 2px solid white;
        }
        
        .custom-origin-marker, .custom-destination-marker {
            background: none !important;
            border: none !important;
        }
        
        .origin-marker {
            font-size: 18px;
            background: linear-gradient(135deg, #10b981, #059669);
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            border: 2px solid white;
        }
        
        .destination-marker {
            font-size: 18px;
            background: linear-gradient(135deg, #f59e0b, #d97706);
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            border: 2px solid white;
        }
        
        .leaflet-popup-content-wrapper {
            border-radius: 8px !important;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
        }
        
        .map-popup {
            padding: 12px;
            border-radius: 8px;
            background: white;
            font-family: inherit;
        }
        
        .map-popup h3, .map-popup h4 {
            margin: 0 0 8px 0;
            color: #1f2937;
            font-weight: 600;
        }
        
        .map-popup p {
            margin: 4px 0;
            color: #4b5563;
            font-size: 14px;
        }
        
        .map-popup small {
            color: #6b7280;
            font-size: 12px;
            font-family: monospace;
        }
        
        .test-section {
            margin-bottom: 30px;
        }
        
        .test-title {
            font-size: 18px;
            font-weight: 600;
            color: #1d1d1f;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üó∫Ô∏è TransitBusCard Map Stop Numbering Test</h1>
        
        <div class="test-section">
            <div class="test-title">Test Data</div>
            <div class="stops-info">
                <strong>Route:</strong> Chennai ‚Üí Coimbatore<br>
                <strong>Total Stops:</strong> <span id="total-stops">5</span><br>
                <strong>Expected:</strong> Numbered markers (1, 2, 3, 4, 5) should appear on the map
                
                <div class="stops-list" id="stops-list">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <div class="test-title">Interactive Map</div>
            <div id="map" class="map-container"></div>
        </div>
        
        <div class="test-section">
            <div class="test-title">Test Results</div>
            <div id="test-results">
                <!-- Results will be populated here -->
            </div>
        </div>
    </div>

    <script>
        // Test data - simulating the data structure from React app
        const fromLocation = {
            id: 1,
            name: "Chennai Central",
            latitude: 13.0827,
            longitude: 80.2707
        };
        
        const toLocation = {
            id: 2,
            name: "Coimbatore",
            latitude: 11.0168,
            longitude: 76.9558
        };
        
        const testStops = [
            { id: 1, name: "Vellore", latitude: 12.9165, longitude: 79.1325, arrivalTime: "08:30" },
            { id: 2, name: "Salem", latitude: 11.6643, longitude: 78.1460, arrivalTime: "10:15" },
            { id: 3, name: "Namakkal", latitude: 11.2189, longitude: 78.1677, arrivalTime: "11:00" },
            { id: 4, name: "Karur", latitude: 10.9601, longitude: 78.0766, arrivalTime: "11:45" },
            { id: 5, name: "Tirupur", latitude: 11.1085, longitude: 77.3411, arrivalTime: "12:30" }
        ];
        
        // Update UI
        document.getElementById('total-stops').textContent = testStops.length;
        
        const stopsList = document.getElementById('stops-list');
        testStops.forEach((stop, index) => {
            const stopItem = document.createElement('div');
            stopItem.className = 'stop-item';
            stopItem.innerHTML = `
                <div class="stop-number">${index + 1}</div>
                <div class="stop-name">${stop.name}</div>
            `;
            stopsList.appendChild(stopItem);
        });
        
        // Initialize map
        function initializeMap() {
            try {
                // Calculate center point
                const centerLat = (fromLocation.latitude + toLocation.latitude) / 2;
                const centerLng = (fromLocation.longitude + toLocation.longitude) / 2;
                
                // Create map
                const map = L.map('map').setView([centerLat, centerLng], 8);
                
                // Add tile layer
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '¬© OpenStreetMap contributors',
                    maxZoom: 19,
                }).addTo(map);
                
                // Origin marker
                const originMarker = L.marker([fromLocation.latitude, fromLocation.longitude], {
                    icon: L.divIcon({
                        html: '<div class="origin-marker">üìç</div>',
                        className: 'custom-origin-marker',
                        iconSize: [35, 35],
                        iconAnchor: [17, 17]
                    })
                }).addTo(map);
                
                originMarker.bindPopup(`
                    <div class="map-popup">
                        <h3>Origin</h3>
                        <p><strong>${fromLocation.name}</strong></p>
                        <small>${fromLocation.latitude.toFixed(4)}, ${fromLocation.longitude.toFixed(4)}</small>
                    </div>
                `);
                
                // Destination marker
                const destinationMarker = L.marker([toLocation.latitude, toLocation.longitude], {
                    icon: L.divIcon({
                        html: '<div class="destination-marker">üéØ</div>',
                        className: 'custom-destination-marker',
                        iconSize: [35, 35],
                        iconAnchor: [17, 17]
                    })
                }).addTo(map);
                
                destinationMarker.bindPopup(`
                    <div class="map-popup">
                        <h3>Destination</h3>
                        <p><strong>${toLocation.name}</strong></p>
                        <small>${toLocation.latitude.toFixed(4)}, ${toLocation.longitude.toFixed(4)}</small>
                    </div>
                `);
                
                // Add numbered stop markers
                let addedStops = 0;
                testStops.forEach((stop, index) => {
                    if (stop.latitude && stop.longitude) {
                        const stopMarker = L.marker([stop.latitude, stop.longitude], {
                            icon: L.divIcon({
                                html: `<div class="stop-marker">${index + 1}</div>`,
                                className: 'custom-stop-marker',
                                iconSize: [25, 25],
                                iconAnchor: [12, 12]
                            })
                        }).addTo(map);
                        
                        stopMarker.bindPopup(`
                            <div class="map-popup">
                                <h4>Stop ${index + 1}</h4>
                                <p><strong>${stop.name}</strong></p>
                                ${stop.arrivalTime ? `<p>Arrival: ${stop.arrivalTime}</p>` : ''}
                                <small>${stop.latitude.toFixed(4)}, ${stop.longitude.toFixed(4)}</small>
                            </div>
                        `);
                        
                        addedStops++;
                    }
                });
                
                // Draw route line
                const routePoints = [
                    [fromLocation.latitude, fromLocation.longitude],
                    ...testStops
                        .filter(stop => stop.latitude && stop.longitude)
                        .map(stop => [stop.latitude, stop.longitude]),
                    [toLocation.latitude, toLocation.longitude]
                ];
                
                if (routePoints.length >= 2) {
                    const routeLine = L.polyline(routePoints, {
                        color: '#3b82f6',
                        weight: 4,
                        opacity: 0.8,
                        dashArray: '10, 5'
                    }).addTo(map);
                    
                    // Fit map to show entire route
                    map.fitBounds(routeLine.getBounds(), { padding: [20, 20] });
                }
                
                // Update test results
                updateTestResults(addedStops);
                
            } catch (error) {
                console.error('Error initializing map:', error);
                document.getElementById('test-results').innerHTML = `
                    <div style="color: red; padding: 10px; background: #ffebee; border-radius: 4px;">
                        <strong>‚ùå Map Initialization Failed:</strong><br>
                        ${error.message}
                    </div>
                `;
            }
        }
        
        function updateTestResults(addedStops) {
            const resultsContainer = document.getElementById('test-results');
            const expectedStops = testStops.length;
            
            let resultHTML = '';
            
            if (addedStops === expectedStops) {
                resultHTML = `
                    <div style="color: green; padding: 10px; background: #e8f5e8; border-radius: 4px;">
                        <strong>‚úÖ Test PASSED:</strong><br>
                        Successfully added ${addedStops} numbered stop markers to the map.<br>
                        All stops should be visible with numbers 1-${expectedStops}.
                    </div>
                `;
            } else {
                resultHTML = `
                    <div style="color: red; padding: 10px; background: #ffebee; border-radius: 4px;">
                        <strong>‚ùå Test FAILED:</strong><br>
                        Expected ${expectedStops} stops, but only added ${addedStops} to the map.<br>
                        Check console for errors and verify stop data has valid coordinates.
                    </div>
                `;
            }
            
            resultsContainer.innerHTML = resultHTML;
        }
        
        // Initialize when page loads
        window.addEventListener('load', () => {
            // Small delay to ensure Leaflet is fully loaded
            setTimeout(initializeMap, 100);
        });
        
        // Debug logging
        console.log('Test stops data:', testStops);
        console.log('From location:', fromLocation);
        console.log('To location:', toLocation);
    </script>
</body>
</html>